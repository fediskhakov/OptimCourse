---
jupytext:
  formats: md:myst
  text_representation:
    extension: .md
    format_name: myst
    format_version: 0.13
    jupytext_version: 1.11.5
---

# Envelope and maximum theorems
**ECON2125/6012 Lecture 8**
Fedor Iskhakov

## Announcements & Reminders

- *Test 3* [results and discussion](https://www.dropbox.com/scl/fi/specehca5vp3qqqo07ocn/test2_distr_prelim.png?rlkey=wytv2hxscmbur18cy504p77k9&dl=0)
- Exam is scheduled to **Monday, 6 November**  9:00 to 12:15, *multiple rooms*

## Plan for this lecture

1. The maximum theorem
2. Envelope theorem

**Supplementary reading:**
- Simon & Blume: 
- Sundaram: 

## Value function and optimization problem parameters

Let's start with recalling the definition of a general optimization problem

```{admonition} Definition
:class: caution

The general form of the optimization problem is

%
$$
V(\theta) 
= \max_{x} f(x,\theta)
\\
\text {subject to}
\\
g_i(x,\theta) = 0, \; i\in\{1,\dots,I\}\\
h_j(x,\theta) \le 0, \; j\in\{1,\dots,J\}
$$
%
where:
- $f(x,\theta) \colon \mathbb{R}^N \times \mathbb{R}^K \to \mathbb{R}$ is an objective function
- $x \in \mathbb{R}^N$ are decision/choice variables
- $\theta \in \mathbb{R}^K$ are parameters
- $g_i(x,\theta) = 0, \; i\in\{1,\dots,I\}$ where $g_i \colon \mathbb{R}^N \times \mathbb{R}^K \to \mathbb{R}$, are equality constraints
- $h_j(x,\theta) \le 0, \; j\in\{1,\dots,J\}$ where $h_j \colon \mathbb{R}^N \times \mathbb{R}^K \to \mathbb{R}$, are inequality constraints
- $V(\theta) \colon \mathbb{R}^K \to \mathbb{R}$ is a value function
```

This lecture focuses on the *value function* in the optimization problem $V(\theta)$, and how it depends on the parameters $\theta$.

In economics we are interested how the optimized behavior changes when the circumstances of the decision-making process change
- income/budget/wealth changes
- intertemporal effects of changes in other time periods

We would like to establish the properties of the value function $V(\theta)$:

- continuity $\rightarrow$ ***The maximum theorem***
- monotonicity $\rightarrow$ Supermodularity and increasing differences (*not covered here*, see Sundaram ch.10)
- derivative (*if differentiable*) $\rightarrow$ ***Envelope theorem***

## The maximum theorem

The main idea of the theorem: when the components of the optimization problem $f(x,\theta)$, $g_i(x,\theta)$ and $h_j(x,\theta)$ are continuous, then the value function $V(\theta)$ is also continuous, in some sense.

- we need to accurately define the notion of continuity for all components of the optimization problem

Denote the admissible set $\mathcal{D}(\theta)$
%
$$
\mathcal{D}(\theta) = \left\{ 
x \in \mathbb{R}^N \times \mathbb{R}^K \colon
g_i(x,\theta) = 0, \; i\in\{1,\dots,I\}, \;
h_j(x,\theta) \le 0, \; j\in\{1,\dots,J\}
\right\}
$$

In solving the optimization problem we are not only interested in the attainable optimal value $V(\theta)$, but also in the set of maximizers/minimizers $\mathcal{D}^\star(\theta)$ corresponding to each parameter value $\theta$

```{admonition} Definition
:class: caution

We will refer to the pair
%
$$
V(\theta) = \max_{x} f(x,\theta) \\
\mathcal{D}^\star(\theta) = \mathrm{arg}\max_x f(x,\theta)
$$
%
as the **solution of the optimization problem**
%
$$
f(x,\theta) \to \max_{x} \\
\text{subject to} \; x \in \mathcal{D}(\theta),
$$
%
where
%
$$
\begin{array}{l}
f(x,\theta) \colon \mathbb{R}^N \times \mathbb{R}^K \to \mathbb{R},\\
\mathcal{D}(\theta) \subset \mathbb{R}(N) \text{ for all } \theta,\\
\theta \in \Theta \subset \mathbb{R}^K
\end{array}
$$

```

Note that the mappings of $\theta$ to $\mathcal{D}(\theta)$ or $\mathcal{D}^\star(\theta)$ are not functions because both $\mathcal{D}(\theta)$ and often $\mathcal{D}^\star(\theta)$ have multiple elements for a given $\theta$

```{admonition} Definition
:class: caution

A correspondence is

```


### Continuity of correspondences

Recall the definition of the continuous function

sequences

Equivalently through the open epsilon-balls


Generalize to correspondences


Upper semi-continuity

Lower semi-continuity


Examples, examples, examples

### The statement of the maximum theorem

General statement of the maximum theorem

The maximum theorem under concavity

### The maximum theorem with unique optimizers

Special case for when the optimizer is unique for each $\theta$

In this case the upper semi-continuity, lower semi-continuity coincide with the "usual" continuity

should be simple

*
*
*
*


```{admonition} Example
:class: tip

Maximization of log utility subject to budget constraint
%
$$ 
u(x_1, x_2) = \alpha \log(x_1) + \beta \log(x_2) \to \max_{x_1, x_2} \\
\text{ subject to} \\
p_1 x_1 + p_2 x_2 \leq m
$$
%
- $p_i$ is the price of good $i$, assumed non-negative
- $m$ is the budget, assumed non-negative
- $\alpha>0$, $\beta>0$
- $x_1 \geq 0, \; x_2 \geq 0$, can show that these constraints never bind


```

```{figure} _static/plots/log_util.png
:scale: 50%
:name: 

Log utility with $\alpha=0.4$, $\beta=0.5$
```

```{figure} _static/plots/budget_set_3.png
:scale: 50%
:name: 

Utility max for $p_1=1$, $p_2 = 1.2$, $m=4$, $\alpha=0.4$,
$\beta=0.5$
```

TODO: Derivation + the plot of the value as function of budget and each price!



```{admonition} Example
:class: tip

Maximization of log-linear utility subject to budget constraint
%
$$ 
u(x_1, x_2) = \alpha x_1 + \beta \log(x_2) \to \max_{x_1, x_2} \\
\text{ subject to} \\
p_1 x_1 + p_2 x_2 \leq m \\
x_1 \geq 0, \; x_2 \geq 0
$$
%
- $p_i$ is the price of good $i$, assumed non-negative
- $m$ is the budget, assumed non-negative
- $\alpha>0$, $\beta>0$


Form the Lagrangian with 3 inequality constraints (have to flip the sign for non-negativity to stay within the general formulation)
%
$$
\mathcal{L}(x_1,x_2,\lambda_1,\lambda_2,\lambda_3) = \\
= \alpha x_1 + \beta\log(x_2)  - \lambda_1 (-x_1) - \lambda_2 (-x_2) - \lambda_3 (p_1 x_1 + p_2 x_2 -m) = \\
= \alpha x_1 + \beta\log(x_2) + \lambda_1 x_1+ \lambda_2 x_2 - \lambda_3 (p_1 x_1 + p_2 x_2 -m)
$$
%
The necessary KKT conditions are given by the following system of equations
%
$$
\begin{cases}
\frac{\partial \mathcal{L}}{\partial x_1} = 0 \implies
\alpha + \lambda_1 - \lambda_3 p_1 = 0 \\
\frac{\partial \mathcal{L}}{\partial x_2} = 0 \implies
\frac{\beta}{x_2} + \lambda_2 - \lambda_3 p_2 = 0 \\
x_1 \ge 0 \\
x_2 \ge 0 \\
x_1 p_1 + x_2 p_2 \le m \\
\lambda_1 \ge 0 \text { and } \lambda_1 x_1 = 0 \\
\lambda_2 \ge 0 \text { and } \lambda_2 x_2 = 0 \\
\lambda_3 \ge 0 \text { and } \lambda_3 (x_1 p_1 + x_2 p_2 -m) = 0 \\
\end{cases}
$$
%
The KKT conditions can be solved systematically by considering all combinations of the multipliers. The two cases where the system is consistent:

1. $\lambda_1>0, \;\lambda_2 = 0, \; \lambda_3 > 0 \implies x_1 = 0$ and $p_1 + x_2 p_2 -m = 0$ \
  We have the following system in this case
  %
  $$
  \begin{cases}
  \alpha + \lambda_1 - \lambda_3 p_1 = 0 \\
  \frac{\beta}{x_2} - \lambda_3 p_2 = 0 \\
  x_2 p_2 -m = 0
  \end{cases}
  $$
  %
  From the last equation $x_2 = m/p_2$, 
  combining the two last equations $\lambda_3 = \beta/m$,
  and from the first equation $\lambda_1 = \beta p_1/m - \alpha$.
  The solution holds conditional on $\lambda_1>0$, i.e. $p_1/m > \alpha/\beta$.

8. $\lambda_1>0, \;\lambda_2 > 0, \; \lambda_3 > 0 \implies x_1 = x_2 = p_1 + x_2 p_2 -m = 0$ \
  Inconsistent similarly to the previous case

To summarize, the solution to the KKT conditions is given by the following cases (it's easy to see that the two solutions coincide for the equality in the parameter condition):
%
$$
\begin{cases}
x_1^\star = \frac{m}{p_1} - \frac{\beta}{\alpha}, \;
x_2^\star = \frac{\beta p_1}{\alpha p_2}, & 
\text{ if } p_1/m \le \alpha/\beta, \\
x_1^\star = 0, \;
x_2^\star = \frac{m}{p_2}, & 
\text{ if } p_1/m > \alpha/\beta \\
\end{cases}
$$

```

```{figure} _static/plots/corner_sol_2.png
:name: 

Corner solution
```


TODO: Derivation + the plot of the value as function of budget and each price!





## Envelope theorem

Next step after continuity -- differentiability of the value function $V(\theta)$ and the marginal effect of relaxing the constraint (*derivatives!*)

```{admonition} Example
:class: tip

Back to the log utility case with interior solution
%
$$ 
u(x_1, x_2) = \alpha \log(x_1) + \beta \log(x_2) \to \max_{x_1, x_2} \\
\text{ subject to} \\
p_1 x_1 + p_2 x_2 \leq m
$$
%
Solution is 

Value function is

```

More generally: Lagrangian multiplier is a shadow price


General form of envelope - CHECK


### Lagrange multiplyers as shadow prices

In the equality constrained optimization problem, the Lagrange multiplier $\lambda_i$ can be interpreted as the shadow price of the constraint $g_i(x,\theta) = 0$.



```{image} _static/img/coming_soon.png
   :scale: 100 %
   :alt: soming soon
   :align: center
```
